<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DAW JSON Link: unknown_types_and_delayed_parsing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DAW JSON Link
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">unknown_types_and_delayed_parsing </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>#Unknown Types and Delayed Parsing</p>
<h1><a class="anchor" id="autotoc_md35"></a>
Unknown JSON Data</h1>
<p>When the data structure is unknown or partially known it can be parsed as a <code>json_delayed</code> type. This also, allows for skipping the parsing of certain members and returning later.</p>
<div class="fragment"><div class="line">[&quot;a&quot;, 2, &quot;b&quot;, 3]</div>
</div><!-- fragment --><p>The above JSON describes an array of mixed types, string and number.</p>
<p>To see a working example using this code, refer to <a href="https://raw.githubusercontent.com/beached/daw_json_link/release/tests/src/cookbook_unknown_types_and_delayed_parsing1_test.cpp">cookbook_unknown_types_and_delayed_parsing1_test.cpp</a>.</p>
<p>Below is the C++ code to parse and use it. </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">std::string_view json_data = ...;</div>
<div class="line">auto val = daw::json::json_value( json_data );</div>
<div class="line">for( auto member : val ) {</div>
<div class="line">  if( member.name ) {</div>
<div class="line">    std::cout &lt;&lt; *member.name &lt;&lt; &quot; is a &quot;;</div>
<div class="line">  } else {</div>
<div class="line">    std::cout &lt;&lt; &quot;Array element is a &quot;;</div>
<div class="line">  }</div>
<div class="line">  std::cout &lt;&lt; to_string( member.value.type( ) ) &lt;&lt; &quot; with a value of &quot;</div>
<div class="line">            &lt;&lt; member.value.get_string_view( ) &lt;&lt; &#39;\n&#39;;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md36"></a>
Delayed Parsing</h1>
<p>It is possible to delay the parsing of json members until a later time. The <code>json_delayed</code> member type will store the character range and allow full parsing later. The cost of doing so is similar to that of skipping the value and is already paid for when parsing JSON data.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;member0&quot;: 5,</div>
<div class="line">  &quot;member_later&quot;: { &quot;a&quot;: 1, &quot;b&quot;:  true },</div>
<div class="line">  &quot;member1&quot;: &quot;Hello world&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The above JSON class has 3 members, a number, a class to parse later, and a string.</p>
<p>To see a working example using this code, refer to <a href="https://raw.githubusercontent.com/beached/daw_json_link/release/tests/src/cookbook_unknown_types_and_delayed_parsing2_test.cpp">cookbook_unknown_types_and_delayed_parsing2_test.cpp</a>.</p>
<p>Below is the C++ code to parse and use it. </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">struct MyClass2 {</div>
<div class="line">  int member0;</div>
<div class="line">  daw::json::json_delayed_value member_later;</div>
<div class="line">  std::string member1;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">struct MyDelayedClass {</div>
<div class="line">  int a;</div>
<div class="line">  bool b; </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">namespace daw::json { </div>
<div class="line">  template&lt;&gt;</div>
<div class="line">  struct json_data_contract&lt;MyClass2&gt; {</div>
<div class="line">    using type = json_member_list&lt;</div>
<div class="line">      json_number&lt;&quot;member0&quot;, int&gt;,</div>
<div class="line">      json_delayed&lt;&quot;member_later&quot;&gt;,</div>
<div class="line">      json_string&lt;&quot;member1&quot;&gt;</div>
<div class="line">    &gt;;</div>
<div class="line"> </div>
<div class="line">    static inline auto</div>
<div class="line">    to_json_data( MyClass2 const &amp;value ) {</div>
<div class="line">      return std::forward_as_tuple( value.member0, value.member_later, value.member1 );</div>
<div class="line">    }</div>
<div class="line">  }; </div>
<div class="line"> </div>
<div class="line">  // This isn&#39;t necessary to parse the values as but allows for directly constructing the object</div>
<div class="line">  template&lt;&gt;</div>
<div class="line">  struct json_data_contract&lt;MyDelayedClass&gt; {</div>
<div class="line">    using type = json_member_list&lt;</div>
<div class="line">      json_number&lt;&quot;a&quot;, int&gt;,</div>
<div class="line">      json_bool&lt;&quot;b&quot;&gt;</div>
<div class="line">    &gt;;</div>
<div class="line"> </div>
<div class="line">    static inline auto</div>
<div class="line">    to_json_data( MyDelayedClass const &amp;value ) {</div>
<div class="line">      return std::forward_as_tuple( value.a, value.b );</div>
<div class="line">    }</div>
<div class="line">  }; </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::string_view json_data = ...;</div>
<div class="line">MyClass2 val = from_json&lt;MyClass2&gt;( json_data );</div>
<div class="line"> </div>
<div class="line">MyDelayedClass delayed_val = cls2.member_layer.template parse&lt;MyDelayedClass&gt;( );</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md37"></a>
RAW JSON</h1>
<p>Parsing to a raw JSON string can be done too. the <code>json_delayed</code> mapping type allows for an optional type argument that specifies the destination/source type. It requires that the type be constructable from a char const * and a std::size_t.</p>
<p>To see a working example using this code, refer to <a href="https://raw.githubusercontent.com/beached/daw_json_link/release/tests/src/cookbook_unknown_types_and_delayed_parsing3_test.cpp">cookbook_unknown_types_and_delayed_parsing3_test.cpp</a>.</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">struct Thing {</div>
<div class="line">  std::string name;</div>
<div class="line">  int type;</div>
<div class="line">  std::string raw_json;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">namespace daw::json {</div>
<div class="line">  template&lt;&gt;</div>
<div class="line">  struct json_data_contract&lt;Thing&gt; {</div>
<div class="line">    using type = json_member_list&lt;json_string&lt;&quot;name&quot;&gt;, json_number&lt;&quot;type&quot;, int&gt;,</div>
<div class="line">                                  json_delayed&lt;&quot;raw_json&quot;, std::string&gt;&gt;;</div>
<div class="line"> </div>
<div class="line">    static auto to_json_data( Thing const &amp;value ) {</div>
<div class="line">      return std::forward_as_tuple( value.name, value.type, value.raw_json );</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line">} // namespace daw::json</div>
<div class="line"> </div>
<div class="line">Thing my_thing = Thing{ &quot;skywalker&quot;, 12345, R&quot;({ &quot;name&quot;: &quot;last&quot; })&quot; };</div>
<div class="line">auto json_string = daw::json::to_json( my_thing );</div>
</div><!-- fragment --><p><code>json_string</code> will have a value of </p><div class="fragment"><div class="line">{&quot;name&quot;:&quot;skywalker&quot;,&quot;type&quot;:12345,&quot;raw_json&quot;:{ &quot;name&quot;: &quot;last&quot; }}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
