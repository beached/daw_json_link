name: Windows

on:
  push:
    branches: [ release, develop ]
  pull_request:
    push:
      branches-ignore: develop
    pull_request:
      branches-ignore: develop

jobs:
  Win_MSVC_x64:
    strategy:
      matrix:
        os: [2019, 2022]
        stdver: [17, 20]
        cfg: [Debug, Release]
    runs-on: windows-${{ matrix.os }}
    steps:
      - uses: actions/checkout@v1
      - name: Build Dependencies
        run: .\ci_scripts\ci_windows_deps.cmd ${{ matrix.os }} ${{ matrix.cfg }} ${{ matrix.stdver }}
      - name: Build
        run: .\ci_scripts\ci_windows_build.cmd ${{ matrix.os }} ${{ matrix.cfg }}
      - name: Test
        run: .\ci_scripts\ci_windows_test.cmd ${{ matrix.os }} ${{ matrix.cfg }}
  Win_MSVC_x86:
    strategy:
      matrix:
        os: [2019, 2022]
        stdver: [17, 20]
        cfg: [Debug, Release]
    runs-on: windows-${{ matrix.os }}
    steps:
      - uses: actions/checkout@v1
      - name: Build Dependencies
        run: .\ci_scripts\ci_windows_deps_x86.cmd ${{ matrix.os }} ${{ matrix.cfg }} ${{ matrix.stdver }}
      - name: Build
        run: .\ci_scripts\ci_windows_build.cmd ${{ matrix.os }} ${{ matrix.cfg }}
      - name: Test
        run: .\ci_scripts\ci_windows_test.cmd ${{ matrix.os }} ${{ matrix.cfg }}
  Win_clang-cl:
    strategy:
      matrix:
        os: [2019]
        stdver: [17, 20]
        cfg: [Debug, Release]
    runs-on: windows-${{ matrix.os }}
    steps:
      - uses: actions/checkout@v1
      - name: Build
        run: .\ci_scripts\ci_windows_build_clangcl.cmd { matrix.os }} ${{ matrix.cfg }} ${{ matrix.stdver }}
      - name: Test
        run: .\ci_scripts\ci_windows_test.cmd ${{ matrix.os }} ${{ matrix.cfg }}
